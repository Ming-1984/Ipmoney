# 页面实现对齐 TODO（基于 Ipmoney.md & 骨架图）

> 目标：对齐需求文档 `Ipmoney.md` 与骨架图 `docs/demo/pages/*.mmd`，补齐前端实现缺口；对“超范围/需决策”部分明确标记并留痕。
> 执行说明：先完成 P0，再推进 P1；涉及产品决策的项先打 “待确认”。

## 0. 基线与范围
- 参考文档：`Ipmoney.md`、`docs/demo/pages/*.mmd`
- 对齐对象：`apps/client`（H5/小程序）与 `apps/admin-web`（如涉及）
- 本文仅列：不对齐 / 超范围 / 缺失 / 待确认

## 1. P0 必须对齐（优先执行）

- [x] **我的页：补齐客服入口**
  - 验收：`/pages/me/index` 内出现“客服中心（电话/在线）”入口，可进入客服页面/会话。
- [x] **我的页：补齐地址管理入口**
  - 验收：新增地址管理页面与入口；支持空态展示，能进入新增/编辑（占位也可）。
- [x] **列表卡片：补齐三类标签**
  - 验收：`ListingCard` 显示“沉睡专利/高新退役/产业集群特色”标签规则：
    - transferCount=0 显示“沉睡专利”；
    - listingTopic=HIGH_TECH_RETIRED 显示“高新退役”；
    - listingTopic=CLUSTER_FEATURED 或 featuredLevel!=NONE 显示“产业集群”。
- [x] **书画卡片：仅保留信息展示**
  - 验收：`ArtworkCard` 不展示收藏/咨询按钮，仅保留作者/年份/价格信息。
- [x] **书画详情：补齐卖家信息与权属材料**
  - 验收：`/pages/artwork/detail` 显示卖家信息（头像/昵称/认证）与权属材料（证书/附件列表）。
- [x] **专利发布：补齐需求字段**
  - 验收：发布表单包含“可交付资料清单、预计周期、可谈空间、质押/许可现状声明”；保存/提交时能持久化（若后端暂不支持，则合并写入摘要并注明）。
- [x] **消息页：系统/官方会话标识**
  - 验收：会话列表中系统/客服类会话展示明显标识（样式/标签）。

## 2. P1 / 待确认（先记录，后执行）

- [x] **详情页结构：单页 vs 多路由**（已确认）
  - 选择：单页滚动 + Sticky Tab（与骨架对齐）。
- [x] **通知/设置/法律/工具类页面是否纳入交付**（已确认）
  - 选择：纳入交付范围，并补到 PRD/骨架。
- [ ] **后台 P1 预留功能**（可延后）
  - CMS、AI 解析复核池、托管监控、告警中心、大数据分析等。

## 3. 执行清单（本轮）
- [x] **详情页单页化（Listing/Demand/Achievement）**：合并摘要/信息/评论到同一页，Tab 改为滚动锚点。
- [x] **PRD/骨架补充辅助页面**：通知/设置/法律/帮助/筛选工具等页面纳入范围说明。

## 4. 执行记录
- 已新增“地址管理”页面与入口（`/pages/addresses/index`）。  
- 专利发布新增字段已落地；由于 OpenAPI 暂无对应字段，已合并写入摘要的“【补充信息】”段落。  
- 详情页已合并为单页（Listing/Demand/Achievement）并支持滚动锚点 Tab。  
- PRD 与骨架说明已补充辅助页面范围。  
- 清理分路由详情页（summary/info/comments/gallery）与相关路由配置。  
- 统一 `ErrorCard` 使用 `onRetry`，修复搜索页错误态；类型检查通过。  
- 移除专利详情多路由子页面（summary/info/comments）路由配置，保持单页滚动结构。  
- 新增后台“订单详情/里程碑”页面并接入路由与入口。  
- 新增上架审核“详情”抽屉入口，占位展示材料与审核记录。  
- 新增后端 listings 模块：后台列表/详情/通过/驳回/特色置顶。  
- 需求/成果/书画审核详情页补齐“材料/审计日志”区块占位。  
- 新增后端 orders 模块：订单创建/列表/详情、支付意图、里程碑、退款、发票、结算/放款。  
- 新增后端 conversations 模块：会话列表、消息收发、已读；补齐挂牌咨询埋点。  
- 新增后端 comments 模块：公开评论列表与新增/编辑/删除。  
- 新增后端 favorites 模块：收藏/取消收藏/收藏列表。  
- 新增后端 demands/achievements/artworks 模块：发布/编辑/提交审核/下架/公开详情/搜索。  
- 新增后端 announcements/notifications/contracts/organizations/tech-managers/inventors 模块。  
- 补齐 listings 前台/发布接口（创建/更新/提交/下架/公开详情/搜索/我的列表）。  
- 新增后端 addresses 模块与认证审核接口（/me/verification、/admin/user-verifications）。  

## 5. 全面检查结论（对齐 & 后端准备度）

### 5.1 需求 & 骨架对齐结论
- **结论：P0 核心前台页面已对齐骨架与需求**（登录/首页/搜索/详情/发布/消息/支付/我的/机构/地图/公告/专家等）。
- **P1/后台能力仍为“预留/待做”**：CMS、AI 解析复核池、托管监控、告警中心、大数据分析等（已在文档标注为 P1，可延后）。
- **已确认的最佳实践已生效**：详情页采用“单页滚动 + Sticky Tab”，辅助页面纳入交付范围。
- **仍有一处“临时兼容”**：专利发布补充字段当前合并写入摘要“【补充信息】”，等待后端字段正式支持。

### 5.2 是否可以启动后端开发
**可以启动（P0 后端开发可并行推进）**，建议按以下边界与优先级开工：
- **P0 必做接口**：登录/用户信息与认证、发布/审核、搜索与筛选、详情、收藏、咨询/消息、订金/尾款支付、订单/退款、客服介入与跟单、公告与机构展示、地址管理。
- **P0 必要数据结构**：专利/成果/需求/书画基础字段、交易字段、标签（沉睡/高新退役/产业集群）、用户角色/认证状态、消息会话类型（系统/官方）。
- **P0 待后端补齐字段**：专利发布“可交付资料清单、预计周期、可谈空间、质押/许可现状声明”等（目前前端已做摘要合并，建议在 API 中结构化落库）。

### 5.3 仍需确认/延后的点（不阻塞 P0）
- 后台 P1 功能模块与权限细节（CMS/AI/告警/数据分析等）。
- 若需 H5 下单支付的合规与渠道方案（当前为“引导回小程序支付”的 P0 方案）。

## 6. 全面对齐核对（Ipmoney.md × 骨架 × 实现）

### 6.1 前端（小程序/H5）对齐结果
- **核心页面：已对齐**（登录/首页/搜索/详情/发布/消息/支付/我的/机构/地图/公告/专家）。
- **辅助页面：已对齐**（通知中心、设置、法务、帮助、筛选工具）。
- **详情页结构：已对齐**（专利/需求/成果均为单页滚动 + Sticky Tab）。

### 6.2 管理后台（admin-web）对齐结果
- **已覆盖：** 仪表盘、用户认证、内容审核（专利/需求/成果/书画）、订单列表（含退款/结算/发票）、订单详情/里程碑、地图数据、系统配置、技术经理人、评论管理。
- **缺失/偏差（P0）：**
  - **内容审核材料/审计日志**仍缺后端支撑，仅提供详情入口占位。
- **P1 预留（缺失合理）：** 平台内容库、AI 解析复核、托管监控、告警中心。

### 6.3 后端（API）对齐结果
- **已覆盖模块：** auth、users、regions、patents、patent-map、files、config、listings、orders、conversations、comments、favorites、demands、achievements、artworks、announcements、notifications、contracts、organizations、tech-managers、inventors、addresses、verification（用户/后台审核）。
- **注意：** 当前部分模块为“内存/占位实现”（非持久化），用于前后端联调与流程对齐；后续需按数据库模型补齐持久化。
- **仍缺后端能力：** 通知中心真实数据来源、合同/发票真实文件上传与权限控制（当前为占位）。

### 6.4 结论（是否“全面对齐”）
- **前端：P0 页面已对齐骨架与需求。**
- **后台：P0 关键页面基本对齐，材料/审计日志待后端支持。**
- **后端：P0 接口已补齐（部分为内存/占位），可进入后端正式开发与持久化落库阶段，但仍需补齐地址/资料设置/认证审核与文件流转。**

## 7. TODO 执行清单（继续对齐）

### 7.1 后台（admin-web）
- [x] 上架审核详情入口（材料/审计日志占位）
- [x] 需求/成果/书画审核详情补齐“材料/审计日志”区块（统一风格与结构）

### 7.2 后端（api）P0 模块
- [x] listings：后台列表/详情/通过/驳回/特色置顶
- [x] orders：用户端订单列表/详情/创建、支付意图、发票/退款/里程碑/放款
- [x] conversations/messages：会话列表、消息收发、已读
- [x] comments：列表/新增/编辑/删除（含后台隐藏/恢复）
- [x] favorites：收藏/取消收藏/收藏列表
- [x] demands/achievements/artworks：发布/编辑/提交审核/下架/公开详情/搜索
- [x] announcements：公告列表/详情（公开）
- [x] notifications：通知列表/详情（系统/客服）
- [x] contracts/invoices：合同中心/发票中心（订单关联）
- [x] organizations/tech-managers/inventors：机构/技术经理人/发明人榜
- [x] addresses/verification：地址管理、认证提交与后台审核流转
