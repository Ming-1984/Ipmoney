erDiagram
  USERS {
    uuid id PK
    string phone
    string nickname
    string role "buyer/seller/admin/cs"
    string region_code
    datetime created_at
    datetime updated_at
  }

  REGIONS {
    string code PK
    string name
    string level "PROVINCE/CITY/DISTRICT"
    string parent_code
    float center_lat
    float center_lng
    string industry_tags_json "json"
    datetime updated_at
  }

  INDUSTRY_TAGS {
    uuid id PK
    string name "unique"
    datetime created_at
    datetime updated_at
  }

  USER_VERIFICATIONS {
    uuid id PK
    uuid user_id FK
    string type "PERSON/COMPANY/ACADEMY/GOVERNMENT/ASSOCIATION/TECH_MANAGER"
    string status "PENDING/APPROVED/REJECTED"
    string display_name
    string unified_social_credit_code_enc
    string contact_name
    string contact_phone
    string region_code
    string intro
    uuid logo_file_id FK
    string evidence_file_ids_json "json"
    datetime submitted_at
    datetime reviewed_at
    uuid reviewed_by FK
    string review_comment
    datetime created_at
    datetime updated_at
  }

  PATENTS {
    uuid id PK
    string jurisdiction "CN"
    string application_no_norm
    string application_no_display
    string patent_type "INVENTION/UTILITY_MODEL/DESIGN"
    string title
    string abstract
    date filing_date
    date publication_date
    date grant_date
    string legal_status
    string source_primary "USER/ADMIN/PROVIDER"
    datetime source_updated_at
    datetime created_at
    datetime updated_at
  }

  PATENT_IDENTIFIERS {
    uuid id PK
    uuid patent_id FK
    string id_type "APPLICATION/PATENT/PUBLICATION"
    string id_value_norm
    string kind_code
    date date_ref
  }

  PATENT_CLASSIFICATIONS {
    uuid id PK
    uuid patent_id FK
    string system "IPC/LOC/CPC"
    string code
    boolean is_main
  }

  PATENT_PARTIES {
    uuid id PK
    uuid patent_id FK
    string role "APPLICANT/INVENTOR/ASSIGNEE"
    string name
    string country_code
  }

  FILES {
    uuid id PK
    string url
    string mime_type
    int size_bytes
    string owner_scope "LISTING/DEMAND/ACHIEVEMENT/CASE/REFUND_REQUEST/INVOICE/USER/USER_VERIFICATION/MESSAGE/AI_PARSE/MAINTENANCE_TASK"
    uuid owner_id
    datetime created_at
  }

  LISTINGS {
    uuid id PK
    uuid seller_user_id FK
    uuid patent_id FK
    string title
    string summary
    string source "USER/PLATFORM/ADMIN"
    string trade_mode "ASSIGNMENT/LICENSE"
    string license_mode "EXCLUSIVE/SOLE/NON_EXCLUSIVE"
    string price_type "FIXED/NEGOTIABLE"
    int price_amount
    int deposit_amount
    string region_code
    string industry_tags_json "json"
    string featured_level "NONE/CITY/PROVINCE"
    string featured_region_code
    int featured_rank
    datetime featured_until
    string audit_status "PENDING/APPROVED/REJECTED"
    string status "DRAFT/ACTIVE/OFF_SHELF/SOLD"
    datetime created_at
    datetime updated_at
  }

  DEMANDS {
    uuid id PK
    uuid publisher_user_id FK
    string title
    string summary
    string cooperation_modes_json "json"
    string budget_type "FIXED/NEGOTIABLE"
    int budget_min
    int budget_max
    string region_code
    string industry_tags_json "json"
    string audit_status "PENDING/APPROVED/REJECTED"
    string status "DRAFT/ACTIVE/OFF_SHELF"
    string source "USER/PLATFORM/ADMIN"
    datetime created_at
    datetime updated_at
  }

  DEMAND_MEDIA {
    uuid id PK
    uuid demand_id FK
    uuid file_id FK
    string type "IMAGE/VIDEO/FILE"
    int sort
  }

  DEMAND_FAVORITES {
    uuid id PK
    uuid demand_id FK
    uuid user_id FK
    datetime created_at
  }

  ACHIEVEMENTS {
    uuid id PK
    uuid publisher_user_id FK
    string title
    string summary
    string maturity "CONCEPT/PROTOTYPE/PILOT/MASS_PRODUCTION/COMMERCIALIZED/OTHER"
    string cooperation_modes_json "json"
    string region_code
    string industry_tags_json "json"
    string audit_status "PENDING/APPROVED/REJECTED"
    string status "DRAFT/ACTIVE/OFF_SHELF"
    string source "USER/PLATFORM/ADMIN"
    datetime created_at
    datetime updated_at
  }

  ACHIEVEMENT_MEDIA {
    uuid id PK
    uuid achievement_id FK
    uuid file_id FK
    string type "IMAGE/VIDEO/FILE"
    int sort
  }

  ACHIEVEMENT_FAVORITES {
    uuid id PK
    uuid achievement_id FK
    uuid user_id FK
    datetime created_at
  }

  LISTING_MEDIA {
    uuid id PK
    uuid listing_id FK
    uuid file_id FK
    string type "IMAGE/FILE"
    int sort
  }

  LISTING_AUDIT_LOGS {
    uuid id PK
    uuid listing_id FK
    uuid reviewer_id FK
    string action "APPROVE/REJECT"
    string reason
    datetime created_at
  }

  LISTING_STATS {
    uuid listing_id PK
    int view_count
    int favorite_count
    int consult_count
    datetime updated_at
  }

  LISTING_FAVORITES {
    uuid id PK
    uuid listing_id FK
    uuid user_id FK
    datetime created_at
  }

  LISTING_CONSULT_EVENTS {
    uuid id PK
    uuid listing_id FK
    uuid user_id FK
    string channel "WECHAT_CS/PHONE/FORM"
    datetime created_at
  }

  USER_TAG_SCORES {
    uuid id PK
    uuid user_id FK
    string tag
    int score
    datetime updated_at
  }

  ORDERS {
    uuid id PK
    uuid listing_id FK
    uuid buyer_user_id FK
    uuid assigned_cs_user_id FK
    string status
    int deal_amount
    int deposit_amount
    int final_amount
    int commission_amount
    string invoice_no
    uuid invoice_file_id FK
    datetime invoice_issued_at
    datetime created_at
    datetime updated_at
  }

  CONVERSATIONS {
    uuid id PK
    string content_type "LISTING/DEMAND/ACHIEVEMENT"
    uuid content_id FK
    uuid order_id FK
    uuid buyer_user_id FK
    uuid seller_user_id FK
    datetime last_message_at
    datetime created_at
    datetime updated_at
  }

  CONVERSATION_PARTICIPANTS {
    uuid id PK
    uuid conversation_id FK
    uuid user_id FK
    datetime last_read_at
    datetime updated_at
  }

  CONVERSATION_MESSAGES {
    uuid id PK
    uuid conversation_id FK
    uuid sender_user_id FK
    string type "TEXT/IMAGE/FILE/SYSTEM"
    string text
    uuid file_id FK
    datetime created_at
  }

  PAYMENTS {
    uuid id PK
    uuid order_id FK
    string pay_type "DEPOSIT/FINAL/REFUND/PAYOUT"
    string channel "WECHAT"
    string trade_no
    int amount
    string status
    datetime paid_at
    datetime created_at
  }

  REFUND_REQUESTS {
    uuid id PK
    uuid order_id FK
    string reason_code
    string reason_text
    string status "PENDING/APPROVED/REJECTED/REFUNDING/REFUNDED"
    datetime created_at
    datetime updated_at
  }

  CS_CASES {
    uuid id PK
    uuid order_id FK
    uuid cs_user_id FK
    string type "FOLLOWUP/REFUND/DISPUTE"
    string status
    datetime created_at
    datetime updated_at
  }

  CS_MILESTONES {
    uuid id PK
    uuid case_id FK
    string name "CONTRACT_SIGNED/TRANSFER_SUBMITTED/TRANSFER_COMPLETED"
    string status
    uuid evidence_file_id FK
    datetime created_at
  }

  SETTLEMENTS {
    uuid id PK
    uuid order_id FK
    int gross_amount
    int commission_amount
    int payout_amount
    string payout_method "MANUAL/WECHAT/..."
    string payout_status "PENDING/SUCCEEDED/FAILED"
    string payout_ref
    uuid payout_evidence_file_id FK
    datetime payout_at
    string status
    datetime created_at
    datetime updated_at
  }

  AI_PARSE_RESULTS {
    uuid id PK
    string content_type "LISTING/DEMAND/ACHIEVEMENT"
    uuid content_id FK
    string summary_plain
    string features_plain
    string keywords_json "json"
    float confidence
    string model_version
    string status "ACTIVE/REVIEW_REQUIRED/REPLACED"
    datetime created_at
    datetime updated_at
  }

  AI_PARSE_FEEDBACK {
    uuid id PK
    uuid parse_result_id FK
    uuid actor_user_id FK
    string actor_type "USER/ADMIN"
    int score
    string reason_tags_json "json"
    string comment
    datetime created_at
  }

  PATENT_MAINTENANCE_SCHEDULES {
    uuid id PK
    uuid patent_id FK
    int year_no
    date due_date
    date grace_period_end
    string status "DUE/PAID/OVERDUE/WAIVED"
    datetime created_at
    datetime updated_at
  }

  PATENT_MAINTENANCE_TASKS {
    uuid id PK
    uuid schedule_id FK
    uuid assigned_cs_user_id FK
    string status "OPEN/IN_PROGRESS/DONE/CANCELLED"
    string note
    uuid evidence_file_id FK
    datetime created_at
    datetime updated_at
  }

  ALERT_EVENTS {
    uuid id PK
    string type
    string severity "LOW/MEDIUM/HIGH"
    string channel "SMS/EMAIL/IN_APP"
    string status "PENDING/SENT/ACKED/SUPPRESSED"
    string target_type "PATENT/ORDER/CONTENT/AI_PARSE/IMPORT/..."
    uuid target_id
    datetime triggered_at
    datetime sent_at
  }

  PATENT_MAP_ENTRIES {
    uuid id PK
    string region_code FK
    int year
    int patent_count
    string industry_breakdown_json "json"
    string top_assignees_json "json"
    datetime created_at
    datetime updated_at
  }

  SYSTEM_CONFIGS {
    uuid id PK
    string key "unique"
    string value_type "INT/DECIMAL/STRING/JSON/BOOL"
    string value
    string scope "GLOBAL/TENANT"
    int version
    uuid updated_by FK
    datetime created_at
    datetime updated_at
  }

  AUDIT_LOGS {
    uuid id PK
    uuid actor_user_id FK
    string action
    string target_type "LISTING/ORDER/REFUND_REQUEST/SYSTEM_CONFIG/..."
    uuid target_id
    string before_json "json"
    string after_json "json"
    string request_id
    string ip
    string user_agent
    datetime created_at
  }

  USERS ||--o{ USER_VERIFICATIONS : verifies
  REGIONS ||--o{ USERS : located_in
  USERS ||--o{ LISTINGS : publishes
  USERS ||--o{ DEMANDS : publishes
  USERS ||--o{ ACHIEVEMENTS : publishes
  USERS ||--o{ ORDERS : places
  USERS ||--o{ LISTING_FAVORITES : favorites
  USERS ||--o{ DEMAND_FAVORITES : favorites
  USERS ||--o{ ACHIEVEMENT_FAVORITES : favorites
  USERS ||--o{ LISTING_CONSULT_EVENTS : consults
  USERS ||--o{ USER_TAG_SCORES : prefers
  USERS ||--o{ CONVERSATION_PARTICIPANTS : participates
  USERS ||--o{ CONVERSATION_MESSAGES : sends
  USERS ||--o{ SYSTEM_CONFIGS : updates
  USERS ||--o{ AUDIT_LOGS : audits
  USERS ||--o{ AI_PARSE_FEEDBACK : reviews
  USERS ||--o{ PATENT_MAINTENANCE_TASKS : assigned

  PATENTS ||--o{ PATENT_IDENTIFIERS : has
  PATENTS ||--o{ PATENT_CLASSIFICATIONS : has
  PATENTS ||--o{ PATENT_PARTIES : has
  PATENTS ||--o{ LISTINGS : referenced_by
  PATENTS ||--o{ PATENT_MAINTENANCE_SCHEDULES : schedules

  LISTINGS ||--o{ LISTING_MEDIA : has
  LISTINGS ||--o{ LISTING_AUDIT_LOGS : audited
  LISTINGS ||--o{ ORDERS : generates
  LISTINGS ||--|| LISTING_STATS : stats
  LISTINGS ||--o{ LISTING_FAVORITES : favored
  LISTINGS ||--o{ LISTING_CONSULT_EVENTS : consulted
  REGIONS ||--o{ LISTINGS : located_in

  DEMANDS ||--o{ DEMAND_MEDIA : has
  DEMANDS ||--o{ DEMAND_FAVORITES : favored
  REGIONS ||--o{ DEMANDS : located_in

  ACHIEVEMENTS ||--o{ ACHIEVEMENT_MEDIA : has
  ACHIEVEMENTS ||--o{ ACHIEVEMENT_FAVORITES : favored
  REGIONS ||--o{ ACHIEVEMENTS : located_in

  %% Polymorphic links via content_type/content_id
  LISTINGS ||--o{ CONVERSATIONS : discussed_in
  DEMANDS ||--o{ CONVERSATIONS : discussed_in
  ACHIEVEMENTS ||--o{ CONVERSATIONS : discussed_in

  AI_PARSE_RESULTS ||--o{ AI_PARSE_FEEDBACK : feedback
  LISTINGS ||--o{ AI_PARSE_RESULTS : parsed
  DEMANDS ||--o{ AI_PARSE_RESULTS : parsed
  ACHIEVEMENTS ||--o{ AI_PARSE_RESULTS : parsed

  PATENT_MAINTENANCE_SCHEDULES ||--o{ PATENT_MAINTENANCE_TASKS : tasks

  FILES ||--o{ LISTING_MEDIA : stored_as
  FILES ||--o{ DEMAND_MEDIA : stored_as
  FILES ||--o{ ACHIEVEMENT_MEDIA : stored_as
  FILES ||--o{ CONVERSATION_MESSAGES : attached
  FILES ||--o{ CS_MILESTONES : evidence
  FILES ||--o{ SETTLEMENTS : payout_evidence
  FILES ||--o{ PATENT_MAINTENANCE_TASKS : evidence
  ORDERS ||--o| FILES : invoice_file
  REFUND_REQUESTS ||--o{ FILES : evidence
  USER_VERIFICATIONS ||--o{ FILES : evidence
  USER_VERIFICATIONS ||--o| FILES : logo

  ORDERS ||--o{ PAYMENTS : has
  ORDERS ||--o{ REFUND_REQUESTS : has
  ORDERS ||--o{ CS_CASES : tracked_by
  ORDERS ||--|| SETTLEMENTS : settles
  ORDERS ||--o{ CONVERSATIONS : links

  CS_CASES ||--o{ CS_MILESTONES : contains

  CONVERSATIONS ||--o{ CONVERSATION_PARTICIPANTS : has
  CONVERSATIONS ||--o{ CONVERSATION_MESSAGES : contains
  PATENT_MAP_ENTRIES }o--|| REGIONS : for_region
